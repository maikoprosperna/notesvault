<body>
  <section id="i2x2" class="gjs-section position-relative py-2 bg-black">
    <div id="container" class="gjs-container container p-2 d-flex justify-content-center align-items-center">
      <h1 id="i4bd" class="playfair-display-cfont text-white">Gallery
      </h1>
    </div>
  </section>
  <section id="ip644" class="gjs-section position-relative py-2 bg-black">
    <div id="io8l" class="gjs-container container p-2 d-flex justify-content-center align-items-center px-2 px-lg-5">
      <div id="itauj" class="gjs-row row bs-row d-flex justify-content-center align-items-center p-2">
        <div id="i5bgh" class="gjs-cell col position-relative bs-column py-2 col-lg-10">
          <p id="izfeu" class="text-center mb-0">Feel free to browse the gallery below for inspiration on luxury jewelry and engagement rings. All the pieces you see here were custom made and hand forged. We'd love to work with you on designing and creating your dream piece, so contact us if you find something you like!
          </p>
        </div>
      </div>
    </div>
  </section>
  <section id="i4ojj" class="gjs-section position-relative py-2 bg-black" data-gjs-removable="false" data-gjs-copyable="false" data-gjs-draggable="false" data-gjs-droppable="false" data-gjs-selectable="false">
    <div id="ihjdq" class="gjs-container container p-2" data-gjs-removable="false" data-gjs-copyable="false" data-gjs-draggable="false" data-gjs-droppable="false" data-gjs-selectable="false">
      <div class="gjs-row row bs-row" data-gjs-removable="false" data-gjs-copyable="false" data-gjs-draggable="false" data-gjs-droppable="false" data-gjs-selectable="false">
        <div class="gjs-cell col-12 col-lg-2 order-1 order-lg-1 position-relative bs-column p-2" data-gjs-removable="false" data-gjs-copyable="false" data-gjs-draggable="false" data-gjs-droppable="false" data-gjs-selectable="false">
          <button class="btn btn-outline-light w-100 d-lg-none mb-3" type="button" data-bs-toggle="collapse" data-bs-target="#filtersCollapse" aria-expanded="false" aria-controls="filtersCollapse" data-gjs-removable="false" data-gjs-copyable="false" data-gjs-draggable="false" data-gjs-droppable="false" data-gjs-selectable="false">
            Filters
          </button>
          <div class="collapse d-lg-block" id="filtersCollapse" data-gjs-removable="false" data-gjs-copyable="false" data-gjs-draggable="false" data-gjs-droppable="false" data-gjs-selectable="false">
            <!-- Filters will be generated by JavaScript -->
          </div>
        </div>
        <div class="gjs-cell col-12 col-lg-10 order-2 order-lg-2 position-relative bs-column p-2" data-gjs-removable="false" data-gjs-copyable="false" data-gjs-draggable="false" data-gjs-droppable="false" data-gjs-selectable="false">
          <div id="irv6t" class="masonry-grid" data-gjs-removable="false" data-gjs-copyable="false" data-gjs-draggable="false" data-gjs-droppable="false" data-gjs-selectable="false">
            <!-- Masonry items will be generated by JavaScript -->
            </div>
          <div class="d-flex align-items-md-center justify-content-md-between justify-content-center align-items-center flex-column flex-md-row" data-gjs-removable="false" data-gjs-copyable="false" data-gjs-draggable="false" data-gjs-droppable="false" data-gjs-selectable="false">
            <div id="view-toggle" style="text-align:center; margin: 1rem 0;" data-gjs-removable="false" data-gjs-copyable="false" data-gjs-draggable="false" data-gjs-droppable="false" data-gjs-selectable="false">
              <select id="page-size-select" class="rounded-0 btn border border-white text-white fs-6 bg-black" data-gjs-removable="false" data-gjs-copyable="false" data-gjs-draggable="false" data-gjs-droppable="false" data-gjs-selectable="false">
                <option value="9">9 per page</option>
                <option value="50">50 per page</option>
                <option value="100">100 per page</option>
                <option value="all">Show All</option>
              </select>
            </div>
            <div id="pagination-controls" class="text-white mx-1 my-0" data-gjs-removable="false" data-gjs-copyable="false" data-gjs-draggable="false" data-gjs-droppable="false" data-gjs-selectable="false"></div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <script>
    console.log("Filter script loaded and running!");
    
    // Filter categories data - easy to add/remove filter categories
    const filterCategories = [
      {
        title: "Category",
        filters: [
          { value: "engagement", label: "Engagement rings" },
          { value: "wedding-bands", label: "Wedding bands" },
          { value: "unique", label: "Unique stones" },
          { value: "earrings", label: "Earrings" },
          { value: "gents", label: "Gents" },
          { value: "necklaces-bracelet", label: "Necklaces / Bracelet" }

        ]
      },
      {
        title: "Ring Type",
        filters: [
          { value: "boule", label: "Boule" },
          { value: "twin", label: "Twin" },
          { value: "three-stone", label: "Three-stone" },
          { value: "five-stone", label: "Five-stone" },
          { value: "signet", label: "Signet" },
          { value: "fashion", label: "Fashion" },
          { value: "solitaire", label: "Solitaire" },
          { value: "halo", label: "Halo" },
          { value: "cluster", label: "Cluster" }
        ]
      },
      {
        title: "Color",
        filters: [
          { value: "blue", label: "Blue" },
          { value: "brown", label: "Brown" },
          { value: "green", label: "Green" },
          { value: "Aqua", label: "Aqua" },
          { value: "Orange", label: "Orange" },
          { value: "pink", label: "Pink" },
          { value: "red", label: "Red" },
          { value: "yellow", label: "Yellow" }
        ]
      }
    ];

    const galleryImages = []; // Image data array - empty since going to be populated by the CSV file
    let allImages = []; // Store all images globally
    let filteredImages = []; // Store filtered images
    let currentPage = 1;
    let itemsPerPage = 9; // Default to 9, but will be dynamic
    let showAllImages = false; // Track view mode

    // Function to fetch gallery data from a CSV file (e.g., from S3)
    async function fetchGalleryData() {
      try {
        // CHANGE THIS URL to your S3 CSV file
        const csvUrl = 'https://p1-mediaserver.s3.ap-southeast-1.amazonaws.com/media/682c27b4bf13aac97635eb2a/maytalhanna_image_array.csv';
        const fetchUrl = csvUrl + (csvUrl.includes('?') ? '&' : '?') + 'cb=' + Date.now(); // cache-busting
        //console.log('Fetching CSV from:', fetchUrl);
        const response = await fetch(fetchUrl);
        const csvText = await response.text();
        
        // Parse CSV
        const lines = csvText.split('\n').filter(line => line.trim());
        if (lines.length < 2) {
          console.error('CSV does not have enough rows');
          return [];
        }
        const headers = lines[0].split(',').map(h => h.trim());
        const data = lines.slice(1).map(line => {
          // Use improved regex to split CSV line, handling quoted fields and commas
          const values = line.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g) || [];
          const cleaned = values.map(v => v.replace(/^"|"$/g, '').trim());
          const obj = {};
          headers.forEach((header, i) => obj[header] = cleaned[i] || '');
          return obj;
        });
        
        // Transform to gallery format
        const transformedData = data.map((row, rowIndex) => ({
          ...row, // include all columns from the CSV row
          id: row.id || row.Id || row[headers[0]] || `item-${Math.random().toString(36).substr(2, 9)}`,
          src: row.src || row.Src || row[headers[1]],
          filters: (row.filters || row.Filters || row[headers[2]] || '')
            .split(',')
            .map(f => f.replace(/^"|"$/g, '').trim())
            .filter(f => f)
        }));
        //console.log('Transformed CSV data:', transformedData);
        return transformedData;
      } catch (error) {
        console.error('Error fetching gallery data from CSV:', error);
        return [];
      }
    }

    // Function to render filters
    function renderFilters() {
      const filtersContainer = document.getElementById('filtersCollapse');
      filtersContainer.innerHTML = '';

      // Create a row for responsive columns
      const row = document.createElement('div');
      row.className = 'row g-2';
      row.id = 'filters-row';

      filterCategories.forEach((category, categoryIndex) => {
        const col = document.createElement('div');
        col.className = 'col-12 col-md-4 col-lg-12 filter-group mb-2';

        // Create category title
        const titleP = document.createElement('p');
        titleP.className = 'text-white mb-2 fw-bold filter-title';
        titleP.textContent = category.title;
        col.appendChild(titleP);

        // Create filter checkboxes
        category.filters.forEach(filter => {
          const label = document.createElement('label');
          label.className = 'label-input-checkbox mb-2 d-flex align-items-center';

          const checkbox = document.createElement('input');
          checkbox.type = 'checkbox';
          checkbox.setAttribute('data-filter', filter.value);
          checkbox.title = filter.value;
          checkbox.className = 'filter me-1';

          label.appendChild(checkbox);
          label.appendChild(document.createTextNode(' ' + filter.label));

          col.appendChild(label);
          //col.appendChild(document.createElement('br'));
        });

        row.appendChild(col);
      });

      filtersContainer.appendChild(row);

      // Re-add event listeners after rendering
      addFilterEventListeners();
    }

    // Function to render pagination controls
    function renderPaginationControls(totalPages) {
      const controls = document.getElementById('pagination-controls');
      controls.innerHTML = '';

      // If there are no results, show nothing
      if (filteredImages.length === 0) {
        return;
      }

      // Show results counter only when showing all images and there are results
      if (showAllImages && filteredImages.length > 0) {
        const resultsCounter = document.createElement('div');
        resultsCounter.className = 'text-white';
        resultsCounter.style.whiteSpace = 'nowrap';
        resultsCounter.textContent = `Showing ${filteredImages.length} items`;
        controls.appendChild(resultsCounter);
        return;
      }

      if (totalPages <= 1) return;
      if (currentPage > 1) {
        const prevBtn = document.createElement('button');
        prevBtn.textContent = 'Previous';
        prevBtn.className = 'pagination-btn rounded-0 btn border border-white text-white fs-6';
        prevBtn.onclick = () => { 
          currentPage--; 
          renderCurrentPage(); 
        };
        controls.appendChild(prevBtn);
      }
      controls.appendChild(document.createTextNode(` Page ${currentPage} of ${totalPages} `));
      if (currentPage < totalPages) {
        const nextBtn = document.createElement('button');
        nextBtn.textContent = 'Next';
        nextBtn.className = 'pagination-btn rounded-0 btn border border-white text-white fs-6';
        nextBtn.onclick = () => { 
          currentPage++; 
          renderCurrentPage(); 
        };
        controls.appendChild(nextBtn);
      }
    }

    // Function to render just the current page (for pagination)
    function renderCurrentPage() {
      const masonryGrid = document.getElementById('irv6t');
      const gridParent = masonryGrid.parentElement;
      const viewToggle = document.getElementById('view-toggle');
      masonryGrid.innerHTML = '';

      // Remove any previous no-images message
      const oldNoImages = document.getElementById('no-images-message');
      if (oldNoImages) oldNoImages.remove();

      // If there are no filtered images, show the message above the grid and hide the grid
      if (filteredImages.length === 0) {
        masonryGrid.style.display = 'none';
        // Hide the view-toggle when no images are found
        if (viewToggle) viewToggle.style.display = 'none';
        
        const noImagesDiv = document.createElement('div');
        noImagesDiv.id = 'no-images-message';
        noImagesDiv.className = 'no-images-message p-1';
        noImagesDiv.innerHTML = `
          <p class="text-center text-white mb-0">
            No images found matching your filters.
            <a href="#" id="reset-filters-link" class="reset-link ms-2">Reset filters</a>
          </p>
        `;
        gridParent.insertBefore(noImagesDiv, masonryGrid);

        // Add event listener for reset link
        const resetLink = document.getElementById('reset-filters-link');
        if (resetLink) {
          resetLink.addEventListener('click', function(e) {
            e.preventDefault();
            // Uncheck all filter checkboxes
            document.querySelectorAll('.filter:checked').forEach(cb => cb.checked = false);
            // Re-render gallery
            filterGallery();
          });
        }

        // Clear pagination/counter
        const controls = document.getElementById('pagination-controls');
        if (controls) controls.innerHTML = '';
        return;
      } else {
        masonryGrid.style.display = '';
        // Show the view-toggle when images are available
        if (viewToggle) viewToggle.style.display = '';
        const oldNoImages = document.getElementById('no-images-message');
        if (oldNoImages) oldNoImages.remove();
      }
      
      let imagesToRender = [];
      
      if (showAllImages) {
        // Show all filtered images
        imagesToRender = [...filteredImages];
        // Hide pagination controls when showing all images
        renderPaginationControls();
      } else {
        // Paginated view
        const specificPageImages = filteredImages.filter(img => img.page && img.page !== '');
        const paginatedImages = filteredImages.filter(img => !img.page || img.page === '');
        
        // Images for this page
        const pageSpecific = specificPageImages.filter(img => parseInt(img.page, 10) === currentPage);
        const startIdx = (currentPage - 1) * itemsPerPage;
        const endIdx = startIdx + itemsPerPage;
        const pagePaginated = paginatedImages.slice(startIdx, endIdx);
        
        // Combine and enforce a strict maximum of itemsPerPage images per page
        imagesToRender = [...pageSpecific, ...pagePaginated].slice(0, itemsPerPage);
        
        // Calculate total pages for paginated images
        const totalPages = Math.max(1, Math.ceil(paginatedImages.length / itemsPerPage));
        renderPaginationControls(totalPages);
      }
      
      /* Debug output
      console.log('Show all images:', showAllImages);
      console.log('Images to render:', imagesToRender.length);
      console.log('All filtered images:', filteredImages.length);*/
      
      // Render images
      const labelSwitch = false;
      imagesToRender.forEach((image, index) => {
        const itemDiv = document.createElement('div');
        itemDiv.className = `masonry-item ${image.filters.join(' ')} p-2`;
        itemDiv.id = `item-${index}`;
        const img = document.createElement('img');
        img.src = image.src;
        img.id = image.id;
        img.title = image.imageName || image.ImageName || '';
        img.style.width = '100%';
        img.style.color = 'black';
        img.loading = 'lazy';
        img.alt = image.imageName || image.ImageName || 'Gallery image';
        itemDiv.appendChild(img);
        if (labelSwitch) {
          const label = document.createElement('label');
          label.textContent = image.id;
          label.style.display = 'block';
          label.style.textAlign = 'center';
          label.style.color = '#fff';
          label.style.marginTop = '0.5rem';
          itemDiv.appendChild(label);
        }
        masonryGrid.appendChild(itemDiv);
      });
    }

    // Function to apply filters to all images
    function applyFilters() {
      const checked = Array.from(document.querySelectorAll('.filter:checked')).map(cb => cb.getAttribute('data-filter').toLowerCase());
      
      if (checked.length === 0) {
        // No filters selected, show all images
        filteredImages = [...allImages];
      } else {
        // Apply filters to all images
        filteredImages = allImages.filter(image => {
          const imageFilters = image.filters.map(f => f.toLowerCase());
          // Show items that match ALL checked filters (AND logic), case-insensitive
          return checked.every(f => imageFilters.includes(f));
        });
      }
      
      // Reset to page 1 when filters change
      currentPage = 1;
      
      /*console.log('Filters applied:', checked);
      console.log('Filtered images count:', filteredImages.length);*/
    }

    // Function to filter gallery
    function filterGallery() {
      applyFilters();
      renderGallery();
    }

    // Function to change page size based on dropdown selection
    function changePageSize() {
      const select = document.getElementById('page-size-select');
      const selectedValue = select.value;
      
      if (selectedValue === 'all') {
        showAllImages = true;
        itemsPerPage = 9; // Keep default for when switching back
      } else {
        showAllImages = false;
        itemsPerPage = parseInt(selectedValue);
      }
      
      // Reset to page 1 when changing page size
      currentPage = 1;
      
      renderCurrentPage();
    }

    // Function to add event listeners to filters
    function addFilterEventListeners() {
    document.querySelectorAll('.filter').forEach(cb => {
      cb.addEventListener('change', function() {
        //console.log("Checkbox changed!");
          filterGallery();
        });
      });
      
      // Add page size dropdown event listener
      const pageSizeSelect = document.getElementById('page-size-select');
      if (pageSizeSelect) {
        pageSizeSelect.addEventListener('change', changePageSize);
      }
    }

    // Function to render gallery
    async function renderGallery() {
      const masonryGrid = document.getElementById('irv6t');
      masonryGrid.innerHTML = '';
      
      // Show loading spinner
      const loadingDiv = document.createElement('div');
      loadingDiv.className = 'text-center text-white p-4 d-flex flex-column align-items-center justify-content-center';
      loadingDiv.style.minHeight = '300px';
      loadingDiv.innerHTML = `
      <p>Loading gallery...</p>
        <div class="spinner-border text-white" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
      `;
      masonryGrid.appendChild(loadingDiv);
      
      // Only fetch data if we don't have it yet
      if (allImages.length === 0) {
        allImages = await fetchGalleryData();
      }
      
      // Apply filters to all images
      applyFilters();
      
      // Clear loading spinner and render current page
      renderCurrentPage();
    }

    // Initialize everything
    renderFilters();
    renderGallery().catch(error => {
      console.error('Error initializing gallery:', error);
    });

    // 1. Add meta tags to the head for SEO and mobile responsiveness
    if (!document.querySelector('meta[name="viewport"]')) {
      const metaViewport = document.createElement('meta');
      metaViewport.name = 'viewport';
      metaViewport.content = 'width=device-width, initial-scale=1';
      document.head.appendChild(metaViewport);
    }
    if (!document.querySelector('title')) {
      const title = document.createElement('title');
      title.textContent = 'Gallery | Custom Jewelry Inspiration';
      document.head.appendChild(title);
    }
    if (!document.querySelector('meta[name="description"]')) {
      const metaDesc = document.createElement('meta');
      metaDesc.name = 'description';
      metaDesc.content = 'Browse our custom jewelry gallery for inspiration. All pieces are hand-forged and custom made.';
      document.head.appendChild(metaDesc);
    }
  </script>
</body>
<style>
  * {
  box-sizing: border-box;
}
body {
  margin: 0;
}
*{
  box-sizing:border-box;
}
body{
  margin:0;
}
.gjs-row{
  min-height:undefinedpx;
  margin:0 !important;
  padding:10px;
}
.bs-row{
  min-height:unset;
}
.bs-column{
  min-height:unset;
}
.gjs-section:empty:before, .gjs-container:empty:before, .gjs-row:empty:before, .gjs-cell:empty:before{
  background-color:#ddd;
  color:#000;
  font-size:20px;
  font-weight:bold;
  height:100%;
  width:100%;
  display:flex;
  align-items:center;
  justify-content:center;
  min-height:300px;
  opacity:0.3;
  border-radius:3px;
  white-space:pre;
  overflow:hidden;
  text-align:center;
  text-overflow:ellipsis;
  content:"+ \A Drag a block here";
}
#i2x2{
  padding-top:50px;
  padding-bottom:50px;
  background-image:url('https://p1media.prosperna.ph/media/682c27b4bf13aac97635eb2a/1750223721098-1750060126703-image%2030.webp');
  background-repeat:no-repeat;
  background-position:center center;
  background-attachment:scroll;
  background-size:cover;
}
#container{
  min-height:300px;
}
#i4bd{
  font-size:56px;
}
#io8l{
  min-height:300px;
}
#ip644{
  padding-top:50px;
  padding-bottom:50px;
}
blockquote{
  position:relative;
  padding-left:20px;
  undefined:undefined;
  font-style:italic;
}
blockquote::before{
  content:"";
  position:absolute;
  top:0;
  left:0;
  width:5px;
  undefined:undefined;
  height:100%;
  background-color:#777777;
}
#i0nd{
  font-family:Open Sans;
  font-size:18px;
  font-weight:700;
}
#ihjdq{
  min-height:300px;
}
#i4ojj{
  padding-top:50px;
  padding-bottom:50px;
}
#izfeu{
  font-family:Open Sans;
  font-size:18px;
  color:#B5B5B5;
}
#ieva5{
  font-family:Open Sans;
  font-size:18px;
  font-weight:700;
}
#i4v4i{
  font-family:Open Sans;
  font-size:18px;
  font-weight:700;
}
#icf4l{
  color:black;
  width:100%;
}
#i2st2{
  color:black;
  width:100%;
}
#iiu9r{
  color:black;
  width:100%;
}
#itt9h{
  color:black;
  width:100%;
}
#i229q{
  color:black;
  width:100%;
}
#ibuka{
  color:black;
  width:100%;
}
#izuhm{
  color:black;
  width:100%;
}
#ixrcm{
  color:black;
  width:100%;
}
#iesrt{
  color:black;
  width:100%;
}
.masonry-grid {
  column-count: 1;
  column-gap: 1rem;
}
@media (min-width: 576px) {
  .masonry-grid {
    column-count: 2;
  }
}
@media (min-width: 992px) {
  .masonry-grid {
    column-count: 3;
  }
}
.masonry-item {
  display: inline-block;
  width: 100%;
  margin-bottom: 1rem;
  vertical-align: top;
}
.no-images-message {
  width: 100% !important;
  text-align: center;
  color: #fff;
  margin: 0 auto;
  display: block;
  grid-column: 1 / -1;
  flex-basis: 100%;
}
#reset-filters-link.reset-link {
  color: #dbbf71 !important;
  text-decoration: none;
}
#reset-filters-link.reset-link:hover {
  text-decoration: underline;
}
.label-input-checkbox {
  color: #B5B5B5;
}
.label-input-checkbox, .filter-title{
  font-size: 18px;
  font-family: 'Open Sans', sans-serif;
}

/* Make checkboxes sharp cornered */
.filter[type="checkbox"] {
  border-radius: 0 !important;
  -webkit-border-radius: 0 !important;
  -moz-border-radius: 0 !important;
}

/* For better visual consistency, also style the checkbox appearance */
.filter[type="checkbox"] {
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  width: 16px;
  height: 16px;
  border: 2px solid #B5B5B5;
  background-color: #ffffff;
  position: relative;
  cursor: pointer;
  border-radius: 0;
}

.filter[type="checkbox"]:checked {
  background-color: #B5B5B5;
  border-color: #B5B5B5;
}

.filter[type="checkbox"]:checked::after {
  content: '✓';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  color: #000;
  font-size: 12px;
  font-weight: bold;
}
</style>